<app-activity-bar [title]="'Done Workout Details'">
    <app-previous-route-button leftSide></app-previous-route-button>
    <button
        type="button"
        class="-translate-y-1"
        (click)="optionsModalVisibility = true"
        rightSide
    >
        <svg
            class="w-8 h-8 transition-all stroke-white fill-white hover:stroke-emerald-500 hover:fill-emerald-500 active:opacity-50 active:scale-95"
            viewBox="0 0 24 24"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
        >
            <path
                d="M12 12.5C12.2761 12.5 12.5 12.2761 12.5 12C12.5 11.7239 12.2761 11.5 12 11.5C11.7239 11.5 11.5 11.7239 11.5 12C11.5 12.2761 11.7239 12.5 12 12.5Z"
                stroke-width="1.5"
                stroke-linecap="round"
                stroke-linejoin="round"
            />
            <path
                d="M12 18.5C12.2761 18.5 12.5 18.2761 12.5 18C12.5 17.7239 12.2761 17.5 12 17.5C11.7239 17.5 11.5 17.7239 11.5 18C11.5 18.2761 11.7239 18.5 12 18.5Z"
                stroke-width="1.5"
                stroke-linecap="round"
                stroke-linejoin="round"
            />
            <path
                d="M12 6.5C12.2761 6.5 12.5 6.27614 12.5 6C12.5 5.72386 12.2761 5.5 12 5.5C11.7239 5.5 11.5 5.72386 11.5 6C11.5 6.27614 11.7239 6.5 12 6.5Z"
                stroke-width="1.5"
                stroke-linecap="round"
                stroke-linejoin="round"
            />
        </svg>
    </button>
</app-activity-bar>

@if (workoutData$ | async; as workoutData) {
<div class="flex flex-col items-center gap-4 p-4">
    <div class="flex flex-col items-center gap-1">
        <div class="text-3xl font-semibold">{{ workoutData.name }}</div>
        <div class="flex items-center gap-1.5">
            <div class="opacity-50">Done by:</div>

            <a class="flex items-center gap-1.5 cursor-pointer">
                <div
                    class="border-2 shadow-[0_0_5px_1px_#10b981] border-solid rounded-full border-emerald-500 overflow-hidden mt-0.5"
                >
                    <img
                        src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSHlY7jda7OEmJpPl0ga2UpDzFX8iE9OyVWICN1Qtefc0EWL9NqvlpI1gxKL4dTHTAuk_U&usqp=CAU"
                        class="w-4 h-4"
                        alt=""
                    />
                </div>

                <div class="font-semibold opacity-50">Albert</div>
            </a>
        </div>
        <div class="text-sm opacity-50">
            {{ workoutData.dateStart | fullDate }}
        </div>
    </div>

    <div class="flex justify-center text-nowrap">
        <div class="flex items-center gap-2 pr-2">
            <div>
                <svg
                    class="w-6 h-6 transition-colors stroke-black dark:stroke-white"
                    viewBox="0 0 24 24"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                >
                    <path
                        d="M12 6L12 12L18 12"
                        stroke-width="1.5"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                    />
                    <path
                        d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z"
                        stroke-width="1.5"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                    />
                </svg>
            </div>

            <div>{{ workoutData.duration | timeFormatter }}</div>
        </div>

        <div
            class="flex items-center gap-2 px-2 border-solid border-x-2 border-neutral-900"
        >
            <div>
                <svg
                    class="w-6 h-6 transition-colors rotate-45 stroke-black dark:stroke-white"
                    viewBox="0 0 24 24"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                >
                    <path
                        d="M7.4 7H4.6C4.26863 7 4 7.26863 4 7.6V16.4C4 16.7314 4.26863 17 4.6 17H7.4C7.73137 17 8 16.7314 8 16.4V7.6C8 7.26863 7.73137 7 7.4 7Z"
                        stroke-width="1.5"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                    />
                    <path
                        d="M19.4 7H16.6C16.2686 7 16 7.26863 16 7.6V16.4C16 16.7314 16.2686 17 16.6 17H19.4C19.7314 17 20 16.7314 20 16.4V7.6C20 7.26863 19.7314 7 19.4 7Z"
                        stroke-width="1.5"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                    />
                    <path
                        d="M1 14.4V9.6C1 9.26863 1.26863 9 1.6 9H3.4C3.73137 9 4 9.26863 4 9.6V14.4C4 14.7314 3.73137 15 3.4 15H1.6C1.26863 15 1 14.7314 1 14.4Z"
                        stroke-width="1.5"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                    />
                    <path
                        d="M23 14.4V9.6C23 9.26863 22.7314 9 22.4 9H20.6C20.2686 9 20 9.26863 20 9.6V14.4C20 14.7314 20.2686 15 20.6 15H22.4C22.7314 15 23 14.7314 23 14.4Z"
                        stroke-width="1.5"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                    />
                    <path
                        d="M8 12H16"
                        stroke-width="1.5"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                    />
                </svg>
            </div>

            <div>{{ workoutData.volume }}kg</div>
        </div>

        <div class="flex items-center gap-2 pl-2">
            <div class="font-medium">Sets:</div>

            <div>{{ workoutData.totalSets }}</div>
        </div>
    </div>

    <button
        type="button"
        (click)="navigateToSummary(workoutData)"
        class="w-full py-2 overflow-hidden font-semibold rounded-md bg-emerald-500 hover:shadow-[0_0_20px_2px_#10b981] transition-all hover:border-transparent active:scale-95 active:opacity-50 text-center"
    >
        See full summary
    </button>

    <div class="flex flex-col self-start w-full gap-4">
        @for (exercise of workoutData.exercises; track $index) {
        <!--  -->
        @if (!noSetsDoneExercisesIndexes.has($index)) {
        <div class="flex flex-col gap-1">
            <a class="flex items-center gap-2">
                <div
                    class="overflow-hidden border-2 border-solid rounded-full min-w-max border-emerald-500"
                >
                    <img
                        [src]="exercise.staticData.imagePreviewUrl"
                        class="w-10 h-10"
                        [alt]="exercise.staticData.imagePreviewUrl + ' image'"
                    />
                </div>
                <div class="text-xl font-semibold text-emerald-500">
                    {{ exercise.staticData.name | titlecase }}
                </div>
            </a>
            <div
                class="grid grid-cols-5 font-semibold opacity-50 justify-items-center"
            >
                <div>Set</div>
                <div>Type</div>
                <div>Kg</div>
                <div>Reps</div>
                <div>Rpe</div>
            </div>
            <div class="flex flex-col gap-1 text-lg">
                @for (set of exercise.sets; track $index) {
                <!--  -->
                @if (set.isDone) {
                <div
                    class="grid grid-cols-5 py-2 font-semibold rounded-md justify-items-center gap-y-3"
                    [ngClass]="{
                        'bg-neutral-900': $index % 2 === 0,
                        'bg-opacity-50': $index % 2 === 0
                    }"
                >
                    <div>{{ set.setNumber }}</div>

                    <div>{{ set.setTypeName[0] | titlecase }}</div>

                    <div>
                        {{ set.weight || "-" }}
                    </div>

                    <div>
                        {{ set.reps || "-" }}
                    </div>

                    <div>
                        {{ set.rpe || "-" }}
                    </div>

                    <!-- TEMPO -->
                    @if (set.setTypeName === 'tempo') {
                    <div class="grid w-full grid-cols-5 col-span-5 py-1">
                        <div class="col-span-2 place-self-center">Tempo:</div>
                        <div
                            class="col-span-3 text-xl text-center select-none place-self-center"
                        >
                            <span>
                                {{ set.tempo?.eccentricPhaseLength || "x" }}
                            </span>
                            <span> - </span>
                            <span>
                                {{ set.tempo?.isometricPhaseOneLength || "x" }}
                            </span>
                            <span> - </span>
                            <span>
                                {{ set.tempo?.concentricPhaseLength || "x" }}
                            </span>
                            <span> - </span>
                            <span>
                                {{ set.tempo?.isometricPhaseTwoLength || "x" }}
                            </span>
                        </div>
                    </div>
                    }

                    <!-- DROPSET(s) -->
                    <!-- prettier-ignore -->
                    @if (set.setTypeName === 'drop') {
                    @for (dropset of set.dropsets; track $index) {
                    <div class="grid w-full grid-cols-5 col-span-5 py-1">
                        <div class="col-span-2 text-nowrap place-self-center">
                            Drop {{ $index + 1 }}:
                        </div>
                        <div class="place-self-center">
                            {{ dropset.weight || "-" }}
                        </div>
                        <div class="place-self-center">
                            {{ dropset.reps || "-" }}
                        </div>
                        <div class="place-self-center">
                            {{ dropset.rpe || "-" }}
                        </div>
                    </div>
                    } }

                    <!-- CLUSTERSET(s) -->
                    <!-- prettier-ignore -->
                    @if (set.setTypeName === 'cluster') {
                    @for (clusterset of set.clustersets; track $index) {
                    <div class="grid w-full grid-cols-5 col-span-5 py-1">
                        <div class="col-span-2 text-nowrap place-self-center">
                            Rest Time:
                        </div>
                        <div class="place-self-center">
                            {{ clusterset.restTime || "-" }}
                        </div>
                        <div class="place-self-center">
                            {{ clusterset.reps || "-" }}
                        </div>
                        <div class="place-self-center">
                            {{ clusterset.rpe || "-" }}
                        </div>
                    </div>
                    } }
                </div>
                }
                <!--  -->
                }
            </div>
        </div>
        }
        <!--  -->
        }
    </div>
</div>

<!--  -->
@if (optionsModalVisibility) {
<!-- eslint-disable-next-line    -->
<div
    @openClose2
    (click)="optionsModalVisibility = false"
    class="fixed top-0 left-0 z-40 w-screen h-screen bg-black bg-opacity-80"
></div>

<div
    @openClose
    class="fixed left-0 z-50 flex flex-col items-center w-full h-full gap-3 p-4 text-lg rounded-t-md bg-neutral-950"
    [ngClass]="{
        'top-2/3': optionsModalVisibility,
        'top-full': !optionsModalVisibility
    }"
>
    <div class="self-center font-semibold text-center">
        Choose action for
        <span class="text-emerald-500">{{ workoutData.name }}</span> workout:
    </div>

    <div class="flex flex-col w-full gap-1">
        <button
            type="button"
            (click)="navigateToEditView(workoutData)"
            class="flex items-center gap-2 p-2 transition-all rounded-md active:opacity-50 active:scale-95 hover:bg-neutral-900 group"
        >
            <div class="mt-1 overflow-hidden rounded-full">
                <svg
                    class="w-5 h-5 stroke-white"
                    viewBox="0 0 24 24"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                >
                    <path
                        d="M13.0207 5.82839L15.8491 2.99996L20.7988 7.94971L17.9704 10.7781M13.0207 5.82839L3.41405 15.435C3.22652 15.6225 3.12116 15.8769 3.12116 16.1421V20.6776H7.65669C7.92191 20.6776 8.17626 20.5723 8.3638 20.3847L17.9704 10.7781M13.0207 5.82839L17.9704 10.7781"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                    />
                </svg>
            </div>
            <div class="font-semibold text-white">Edit</div>
        </button>

        <button
            type="button"
            (click)="confirmDeleteModalVisibility = true"
            class="flex items-center gap-2 p-2 transition-all rounded-md active:opacity-50 active:scale-95 hover:bg-neutral-900 group"
        >
            <div class="mt-1 overflow-hidden rounded-full">
                <svg
                    class="w-5 h-5 stroke-red-500"
                    viewBox="0 0 24 24"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                >
                    <path
                        d="M19 11V20.4C19 20.7314 18.7314 21 18.4 21H5.6C5.26863 21 5 20.7314 5 20.4V11"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                    />
                    <path
                        d="M10 17V11"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                    />
                    <path
                        d="M14 17V11"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                    />
                    <path
                        d="M21 7L16 7M3 7L8 7M8 7V3.6C8 3.26863 8.26863 3 8.6 3L15.4 3C15.7314 3 16 3.26863 16 3.6V7M8 7L16 7"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                    />
                </svg>
            </div>
            <div class="font-semibold text-red-500 mt-0.5">Delete Workout</div>
        </button>
    </div>
</div>
}

<!--  -->
@if (optionsModalVisibility) {
<div
    @openClose3
    class="fixed left-0 z-50 w-full p-4 shadow-md rounded-t-md"
    [ngClass]="{
        'bottom-0': optionsModalVisibility,
        '-bottom-full': !optionsModalVisibility,
    }"
>
    <button
        type="button"
        (click)="optionsModalVisibility = false"
        class="py-1.5 text-lg mt-2 font-semibold rounded-md w-full bg-neutral-900 transition-all active:scale-95 active:opacity-50 hover:shadow-[0_0_20px_2px_#171717] disabled:opacity-50 disabled:cursor-not-allowed disabled:active:scale-100 disabled:hover:shadow-none"
    >
        Close
    </button>
</div>
}

<!--  -->
@if (confirmDeleteModalVisibility) {
<!-- eslint-disable-next-line -->
<div
    @openClose5
    (click)="confirmDeleteModalVisibility = false"
    class="fixed top-0 left-0 z-50 w-screen h-screen bg-black bg-opacity-80"
></div>

<div
    @openClose4
    class="fixed left-0 z-50 flex flex-col items-center w-full h-full gap-3 p-4 text-lg rounded-t-md bg-neutral-950"
    [ngClass]="{
        'top-3/4': optionsModalVisibility,
        'top-full': !optionsModalVisibility
    }"
>
    <div class="font-semibold text-center">
        Are you sure you want to delete
        <span class="text-emerald-500">{{ workoutData.name }}</span> workout?
    </div>
</div>
<!--  -->
}

<!--  -->
@if (confirmDeleteModalVisibility) {
<div
    @openClose6
    class="fixed left-0 z-50 w-full p-4 shadow-md rounded-t-md bg-neutral-950"
    [ngClass]="{
        'bottom-0': confirmDeleteModalVisibility,
        '-bottom-full': !confirmDeleteModalVisibility,
    }"
>
    <button
        type="button"
        (click)="deleteWorkout(workoutData.workoutTemplateId, workoutData.id)"
        class="py-1.5 font-semibold rounded-md w-full bg-red-500 transition-all active:scale-95 active:opacity-50 hover:shadow-[0_0_15px_2px_#ef4444] disabled:opacity-50 disabled:cursor-not-allowed disabled:active:scale-100 disabled:hover:shadow-none"
    >
        Confirm Deletion
    </button>
    <button
        type="button"
        (click)="confirmDeleteModalVisibility = false"
        class="py-1.5 mt-2 font-semibold rounded-md w-full bg-neutral-900 transition-all active:scale-95 active:opacity-50 hover:shadow-[0_0_20px_2px_#171717] disabled:opacity-50 disabled:cursor-not-allowed disabled:active:scale-100 disabled:hover:shadow-none"
    >
        Cancel & Close
    </button>
</div>
}
<!--  -->
} @else {
<div class="flex flex-col items-center w-full gap-2 p-4">
    <div
        data-placeholder
        class="relative w-40 h-2 overflow-hidden rounded-full bg-neutral-900"
    ></div>
    <div
        data-placeholder
        class="relative w-40 h-2 overflow-hidden rounded-full bg-neutral-900"
    ></div>
    <div
        data-placeholder
        class="relative h-2 overflow-hidden rounded-full w-52 bg-neutral-900"
    ></div>
    <div
        data-placeholder
        class="relative h-2 overflow-hidden rounded-full w-60 bg-neutral-900"
    ></div>
    <div
        data-placeholder
        class="relative h-2 mt-2 overflow-hidden rounded-full w-80 bg-neutral-900"
    ></div>
    <div
        data-placeholder
        class="relative h-2 overflow-hidden rounded-full w-80 bg-neutral-900"
    ></div>

    <div class="flex flex-col self-start w-full gap-4 mt-4">
        @for (exercise of [1,2,3]; track $index) {
        <div class="flex flex-col gap-3">
            <div class="flex items-center gap-2">
                <div class="w-12 h-12 rounded-full bg-neutral-900"></div>
                <div class="flex flex-col gap-1">
                    <div
                        data-placeholder
                        class="relative h-2 overflow-hidden rounded-full w-36 bg-neutral-900"
                    ></div>
                    <div
                        data-placeholder
                        class="relative w-40 h-2 overflow-hidden rounded-full bg-neutral-900"
                    ></div>
                </div>
            </div>

            <div class="flex flex-col gap-8">
                @for (set of [1,2,3]; track $index) {
                <div class="flex flex-col gap-1">
                    <div
                        data-placeholder
                        class="relative w-full h-2 overflow-hidden rounded-md bg-neutral-900"
                    ></div>
                    <div
                        data-placeholder
                        class="relative w-full h-2 overflow-hidden rounded-md bg-neutral-900"
                    ></div>
                </div>
                }
            </div>
        </div>
        }
    </div>
</div>
}
